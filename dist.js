function range(e){for(var n=[],t=2;t<=e;t++)n.push(t);return n}function shuffle(e){for(var n=0;n<e.length;n++){var t=Math.floor(e.length*Math.random()),r=e[n];e[n]=e[t],e[t]=r}return e}function lessThan(e,n){return e<n||e-n==10}function Game(e){this.score=0,this.t=0,this.a1=null,this.a2=null,this.d1=null,this.d2=null,this.hand=0,this.deck=shuffle(range(99)),this.handlers=e,this.undoStack=[];for(var n=0;n<4;n++)this.draw2()}nut=function(e,n){return n=nut.el(n),[].slice.call(/^\.[\w\-]+$/.test(e)?n.getElementsByClassName(e.slice(1)):n.querySelectorAll(e))},nut.el=function(e,n){return"string"!=typeof e?e||document:(n=nut.el(n),/^#[\w\-]+$/.test(e)&&n.getElementById?n.getElementById(e.slice(1)):n.querySelector(e))},function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).dragula=e()}}(function(){return function i(a,u,c){function l(t,e){if(!u[t]){if(!a[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(s)return s(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var o=u[t]={exports:{}};a[t][0].call(o.exports,function(e){var n=a[t][1][e];return l(n||e)},o,o.exports,i,a,u,c)}return u[t].exports}for(var s="function"==typeof require&&require,e=0;e<c.length;e++)l(c[e]);return l}({1:[function(e,n,t){"use strict";function r(e){var n=o[e];return n?n.lastIndex=0:o[e]=n=new RegExp(i+e+a,"g"),n}var o={},i="(?:^|\\s)",a="(?:\\s|$)";n.exports={add:function(e,n){var t=e.className;t.length?r(n).test(t)||(e.className+=" "+n):e.className=n},rm:function(e,n){e.className=e.className.replace(r(n)," ").trim()}}},{}],2:[function(e,n,t){(function(o){"use strict";function U(e,n,t,r){o.navigator.pointerEnabled?Q[n](e,{mouseup:"pointerup",mousedown:"pointerdown",mousemove:"pointermove"}[t],r):o.navigator.msPointerEnabled?Q[n](e,{mouseup:"MSPointerUp",mousedown:"MSPointerDown",mousemove:"MSPointerMove"}[t],r):(Q[n](e,{mouseup:"touchend",mousedown:"touchstart",mousemove:"touchmove"}[t],r),Q[n](e,t,r))}function q(e){if(void 0!==e.touches)return e.touches.length;if(void 0!==e.which&&0!==e.which)return e.which;if(void 0!==e.buttons)return e.buttons;var n=e.button;return void 0!==n?1&n?1:2&n?3:4&n?2:0:void 0}function A(e,n){return void 0!==o[n]?o[n]:ee.clientHeight?ee[e]:Z.body[e]}function R(e,n,t){var r,o=e||{},i=o.className;return o.className+=" gu-hide",r=Z.elementFromPoint(n,t),o.className=i,r}function H(){return!1}function j(){return!0}function _(e){return e.width||e.right-e.left}function F(e){return e.height||e.bottom-e.top}function G(e){return e.parentNode===Z?null:e.parentNode}function K(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||"SELECT"===e.tagName||function e(n){return!!n&&("false"!==n.contentEditable&&("true"===n.contentEditable||e(G(n))))}(e)}function z(n){return n.nextElementSibling||function(){for(var e=n;(e=e.nextSibling)&&1!==e.nodeType;);return e}()}function V(e,n){var t,r=(t=n).targetTouches&&t.targetTouches.length?t.targetTouches[0]:t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:t,o={pageX:"clientX",pageY:"clientY"};return e in o&&!(e in r)&&o[e]in r&&(e=o[e]),r[e]}var J=e("contra/emitter"),Q=e("crossvent"),W=e("./classes"),Z=document,ee=Z.documentElement;n.exports=function(e,n){function a(e){return-1!==D.containers.indexOf(e)||P.isContainer(e)}function t(e){var n=e?"remove":"add";U(ee,n,"mousedown",o),U(ee,n,"mouseup",v)}function u(e){U(ee,e?"remove":"add","mousemove",i)}function c(e){var n=e?"remove":"add";Q[n](ee,"selectstart",r),Q[n](ee,"click",r)}function r(e){X&&e.preventDefault()}function o(e){if(O=e.clientX,L=e.clientY,1===q(e)&&!e.metaKey&&!e.ctrlKey){var n=e.target,t=l(n);t&&(X=t,u(),"mousedown"===e.type&&(K(n)?n.focus():e.preventDefault()))}}function i(e){if(X){if(0===q(e))return void v({});if(void 0===e.clientX||e.clientX!==O||void 0===e.clientY||e.clientY!==L){if(P.ignoreInputTextSelection){var n=V("clientX",e),t=V("clientY",e);if(K(Z.elementFromPoint(n,t)))return}var r=X;u(!0),c(),d(),s(r);var o={left:(i=T.getBoundingClientRect()).left+A("scrollLeft","pageXOffset"),top:i.top+A("scrollTop","pageYOffset")};k=V("pageX",e)-o.left,N=V("pageY",e)-o.top,W.add(I||T,"gu-transit"),function(){if(!S){var e=T.getBoundingClientRect();(S=T.cloneNode(!0)).style.width=_(e)+"px",S.style.height=F(e)+"px",W.rm(S,"gu-transit"),W.add(S,"gu-mirror"),P.mirrorContainer.appendChild(S),U(ee,"add","mousemove",w),W.add(P.mirrorContainer,"gu-unselectable"),D.emit("cloned",S,T,"mirror")}}(),w(e)}}var i}function l(e){if(!(D.dragging&&S||a(e))){for(var n=e;G(e)&&!1===a(G(e));){if(P.invalid(e,n))return;if(!(e=G(e)))return}var t=G(e);if(t&&!P.invalid(e,n)&&P.moves(e,t,n,z(e)))return{item:e,source:t}}}function s(e){var n,t;n=e.item,t=e.source,("boolean"==typeof P.copy?P.copy:P.copy(n,t))&&(I=e.item.cloneNode(!0),D.emit("cloned",I,e.item,"copy")),x=e.source,T=e.item,$=M=z(e.item),D.dragging=!0,D.emit("drag",T,x)}function d(){if(D.dragging){var e=I||T;h(e,G(e))}}function f(){u(!(X=!1)),c(!0)}function v(e){if(f(),D.dragging){var n=I||T,t=V("clientX",e),r=V("clientY",e),o=b(R(S,t,r),t,r);o&&(I&&P.copySortSource||!I||o!==x)?h(n,o):P.removeOnSpill?p():m()}}function h(e,n){var t=G(e);I&&P.copySortSource&&n===x&&t.removeChild(T),y(n)?D.emit("cancel",e,x,x):D.emit("drop",e,n,x,M),g()}function p(){if(D.dragging){var e=I||T,n=G(e);n&&n.removeChild(e),D.emit(I?"cancel":"remove",e,n,x),g()}}function m(e){if(D.dragging){var n=0<arguments.length?e:P.revertOnSpill,t=I||T,r=G(t),o=y(r);!1===o&&n&&(I?r&&r.removeChild(I):x.insertBefore(t,$)),o||n?D.emit("cancel",t,x,x):D.emit("drop",t,r,x,M),g()}}function g(){var e=I||T;f(),S&&(W.rm(P.mirrorContainer,"gu-unselectable"),U(ee,"remove","mousemove",w),G(S).removeChild(S),S=null),e&&W.rm(e,"gu-transit"),B&&clearTimeout(B),D.dragging=!1,Y&&D.emit("out",e,Y,x),D.emit("dragend",e),x=T=I=$=M=B=Y=null}function y(e,n){var t;return t=void 0!==n?n:S?M:z(I||T),e===x&&t===$}function b(t,r,o){function e(){if(!1===a(i))return!1;var e=C(i,t),n=E(i,e,r,o);return!!y(i,n)||P.accepts(T,i,x,n)}for(var i=t;i&&!e();)i=G(i);return i}function w(e){function n(e){D.emit(e,a,Y,x)}if(S){e.preventDefault();var t=V("clientX",e),r=V("clientY",e),o=t-k,i=r-N;S.style.left=o+"px",S.style.top=i+"px";var a=I||T,u=R(S,t,r),c=b(u,t,r),l=null!==c&&c!==Y;(l||null===c)&&(Y&&n("out"),Y=c,l&&n("over"));var s=G(a);if(c===x&&I&&!P.copySortSource)return void(s&&s.removeChild(a));var d,f=C(c,u);if(null!==f)d=E(c,f,t,r);else{if(!0!==P.revertOnSpill||I)return void(I&&s&&s.removeChild(a));d=$,c=x}(null===d&&l||d!==a&&d!==z(a))&&(M=d,c.insertBefore(a,d),D.emit("shadow",a,c,x))}}function C(e,n){for(var t=n;t!==e&&G(t)!==e;)t=G(t);return t===ee?null:t}function E(o,e,i,a){var n,u="horizontal"===P.direction;return e!==o?(n=e.getBoundingClientRect(),(u?i>n.left+_(n)/2:a>n.top+F(n)/2)?z(e):e):function(){var e,n,t,r=o.children.length;for(e=0;e<r;e++){if(t=(n=o.children[e]).getBoundingClientRect(),u&&t.left+t.width/2>i)return n;if(!u&&t.top+t.height/2>a)return n}return null}()}1===arguments.length&&!1===Array.isArray(e)&&(n=e,e=[]);var S,x,T,k,N,O,L,$,M,I,B,X,Y=null,P=n||{};void 0===P.moves&&(P.moves=j),void 0===P.accepts&&(P.accepts=j),void 0===P.invalid&&(P.invalid=function(){return!1}),void 0===P.containers&&(P.containers=e||[]),void 0===P.isContainer&&(P.isContainer=H),void 0===P.copy&&(P.copy=!1),void 0===P.copySortSource&&(P.copySortSource=!1),void 0===P.revertOnSpill&&(P.revertOnSpill=!1),void 0===P.removeOnSpill&&(P.removeOnSpill=!1),void 0===P.direction&&(P.direction="vertical"),void 0===P.ignoreInputTextSelection&&(P.ignoreInputTextSelection=!0),void 0===P.mirrorContainer&&(P.mirrorContainer=Z.body);var D=J({containers:P.containers,start:function(e){var n=l(e);n&&s(n)},end:d,cancel:m,remove:p,destroy:function(){t(!0),v({})},canMove:function(e){return!!l(e)},dragging:!1});return!0===P.removeOnSpill&&D.on("over",function(e){W.rm(e,"gu-hide")}).on("out",function(e){D.dragging&&W.add(e,"gu-hide")}),t(),D}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./classes":1,"contra/emitter":5,crossvent:6}],3:[function(e,n,t){n.exports=function(e,n){return Array.prototype.slice.call(e,n)}},{}],4:[function(e,n,t){"use strict";var r=e("ticky");n.exports=function(e,n,t){e&&r(function(){e.apply(t||null,n||[])})}},{ticky:9}],5:[function(e,n,t){"use strict";var u=e("atoa"),c=e("./debounce");n.exports=function(o,e){var i=e||{},a={};return void 0===o&&(o={}),o.on=function(e,n){return a[e]?a[e].push(n):a[e]=[n],o},o.once=function(e,n){return n._once=!0,o.on(e,n),o},o.off=function(e,n){var t=arguments.length;if(1===t)delete a[e];else if(0===t)a={};else{var r=a[e];if(!r)return o;r.splice(r.indexOf(n),1)}return o},o.emit=function(){var e=u(arguments);return o.emitterSnapshot(e.shift()).apply(this,e)},o.emitterSnapshot=function(r){var e=(a[r]||[]).slice(0);return function(){var n=u(arguments),t=this||o;if("error"===r&&!1!==i.throws&&!e.length)throw 1===n.length?n[0]:n;return e.forEach(function(e){i.async?c(e,n,t):e.apply(t,n),e._once&&o.off(r,e)}),o}},o}},{"./debounce":4,atoa:3}],6:[function(t,r,e){(function(l){"use strict";function s(e,n,t){var r=function(e,n,t){var r,o;for(r=0;r<d.length;r++)if((o=d[r]).element===e&&o.type===n&&o.fn===t)return r}(e,n,t);if(r){var o=d[r].wrapper;return d.splice(r,1),o}}var i=t("custom-event"),a=t("./eventmap"),u=l.document,e=function(e,n,t,r){return e.addEventListener(n,t,r)},n=function(e,n,t,r){return e.removeEventListener(n,t,r)},d=[];l.addEventListener||(e=function(e,n,t){return e.attachEvent("on"+n,(a=s(r=e,o=n,i=t)||(u=r,c=i,function(e){var n=e||l.event;n.target=n.target||n.srcElement,n.preventDefault=n.preventDefault||function(){n.returnValue=!1},n.stopPropagation=n.stopPropagation||function(){n.cancelBubble=!0},n.which=n.which||n.keyCode,c.call(u,n)}),d.push({wrapper:a,element:r,type:o,fn:i}),a));var r,o,i,a,u,c},n=function(e,n,t){var r=s(e,n,t);return r?e.detachEvent("on"+n,r):void 0}),r.exports={add:e,remove:n,fabricate:function(e,n,t){var r,o=-1===a.indexOf(n)?new i(n,{detail:t}):(u.createEvent?(r=u.createEvent("Event")).initEvent(n,!0,!0):u.createEventObject&&(r=u.createEventObject()),r);e.dispatchEvent?e.dispatchEvent(o):e.fireEvent("on"+n,o)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./eventmap":7,"custom-event":8}],7:[function(e,o,n){(function(e){"use strict";var n=[],t="",r=/^on/;for(t in e)r.test(t)&&n.push(t.slice(2));o.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],8:[function(e,t,n){(function(e){var n=e.CustomEvent;t.exports=function(){try{var e=new n("cat",{detail:{foo:"bar"}});return"cat"===e.type&&"bar"===e.detail.foo}catch(e){}return!1}()?n:"function"==typeof document.createEvent?function(e,n){var t=document.createEvent("CustomEvent");return n?t.initCustomEvent(e,n.bubbles,n.cancelable,n.detail):t.initCustomEvent(e,!1,!1,void 0),t}:function(e,n){var t=document.createEventObject();return t.type=e,n?(t.bubbles=Boolean(n.bubbles),t.cancelable=Boolean(n.cancelable),t.detail=n.detail):(t.bubbles=!1,t.cancelable=!1,t.detail=void 0),t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],9:[function(e,n,t){var r;r="function"==typeof setImmediate?function(e){setImmediate(e)}:function(e){setTimeout(e,0)},n.exports=r},{}]},{},[2])(2)}),Game.prototype={draw2:function(){this.handlers.newCards([this.deck.pop(),this.deck.pop()]),this.hand+=2},remaining:function(){return this.deck.length+this.hand},accepts:function(e,n){var t=this[e];return null===t||("a1"===e||"a2"===e?lessThan(t,n):lessThan(n,t))},scoreOf:function(e){var n=Math.abs(e),t=Math.floor(1+this.t/25)*n;return 10===n?2*t:t},move:function(e,n){if(this.accepts(e,n)){var t=this[e];this.undoStack.push({score:this.score,id:e,top:t,card:n}),this.t++,this.hand--,this.score+=this.scoreOf(n-(t||0)),this[e]=n,this.t%2==0&&0<this.deck.length&&(this.undoStack=[],this.draw2())}},canUndo:function(){return 0<this.undoStack.length},undo:function(){if(this.canUndo()){var e=this.undoStack.pop();this.t--,this.hand++,this.score=e.score,this[e.id]=e.top,this.handlers.undo(e.card,e.id,e.top)}},hasMoves:function(e){if(!(this.a1&&this.a2&&this.d1&&this.d2))return!0;for(var n=0;n<e.length;n++){var t=e[n];if(lessThan(this.a1,t)||lessThan(this.a2,t)||lessThan(t,this.d1)||lessThan(t,this.d2))return!0}return!1}},$=nut;var hand=$.el("#hand"),piles=$(".pile");piles.push(hand);var drake=dragula(piles,{moves:function(e,n){return n===hand},accepts:function(e,n){return n===hand||game.accepts(n.id,+e.textContent)}});function changeTopCardStyle(r){return function(e,n){var t=$.el(".top",n);t&&(t.style.display=r)}}drake.on("drop",function(e,n){n!==hand&&(n.innerHTML="",n.appendChild(e),e.classList.add("top"),game.move(n.id,+e.textContent),updateNumbers())}),drake.on("over",changeTopCardStyle("none")),drake.on("shadow",changeTopCardStyle("none")),drake.on("out",changeTopCardStyle("inline-block"));var LO="#fde396",HI="#4682b4";function lerpColor(e,n,t){var r=parseInt(e.replace(/#/g,""),16),o=r>>16,i=r>>8&255,a=255&r,u=parseInt(n.replace(/#/g,""),16);return"#"+((1<<24)+(o+t*((u>>16)-o)<<16)+(i+t*((u>>8&255)-i)<<8)+(a+t*((255&u)-a))|0).toString(16).slice(1)}function drawCard(e){var n=document.createElement("div");return n.textContent=e,n.classList.add("card"),n.style.backgroundColor=lerpColor(LO,HI,(e-2)/96),n}function updateNumbers(){$.el("#score").textContent=game.score,$.el("#remaining").textContent=game.remaining(),$.el("#undo").classList.toggle("enabled",game.canUndo());for(var e=[],n=0;n<hand.children.length;n++)e.push(+hand.children[n].textContent);game.hasMoves(e)||setTimeout(function(){$.el("#main").classList.add("game-over");var e=$.el("#gameover");e.classList.remove("hidden"),$.el(".score",e).textContent=game.score,$.el(".remaining",e).textContent=game.remaining()},0)}var game=new Game({newCards:function(e){for(var n=0;n<e.length;n++)hand.appendChild(drawCard(e[n]))},undo:function(e,n,t){var r=$.el("#"+n);if(r.innerHTML="",null!==t){var o=drawCard(t);o.classList.add("top"),r.appendChild(o)}hand.appendChild(drawCard(e)),updateNumbers()}});updateNumbers(),$.el("#undo").addEventListener("click",function(){game.undo()}),$.el("#help").addEventListener("click",function(){$.el("#help-dialog").classList.remove("hidden")}),$.el("#close-help").addEventListener("click",function(){$.el("#help-dialog").classList.add("hidden")});
